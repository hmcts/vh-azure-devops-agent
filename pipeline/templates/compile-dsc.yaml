parameters:
  - name: azureDevOpsPAT
  - name: numberOfAgents
  - name: azureDevOpsURL
  - name: vmName
steps:

  - task: PowerShell@2
    displayName: 'Compile DSC'
    inputs:
      targetType: 'inline'
      script: |
        cd ./dsc
        Install-Module cChoco -Force
        . ./SelfHostedAgent.ps1
        SelfHostedAgent -OutputPath ./ -azureDevOpsPAT ${{ parameters.azureDevOpsPAT }} -numberOfAgents ${{ parameters.numberOfAgents }} -azureDevOpsURL ${{ parameters.azureDevOpsURL }} -vmName ${{ parameters.vmName }}
        Move-Item -Path C:\SelfHostedAgent.ps1 -Destination "../terraform/SelfHostedAgent.ps1"
        Get-Content ./localhost.mof | Set-Content -Encoding utf8 "../terraform/localhost.mof"