parameters:
  - name: azureDevOpsPAT
  - name: numberOfAgents
  - name: azureDevOpsURL

steps:

  - task: PowerShell@2
    displayName: 'Compile DSC'
    inputs:
      targetType: 'inline'
      script: |
        cd ./dsc
        Install-Module cChoco -Force
        . ./SelfHostedAgent.ps1
        SelfHostedAgent -OutputPath ./ -azureDevOpsPAT ${{ parameters.azureDevOpsPAT }} -numberOfAgents ${{ parameters.numberOfAgents }} -azureDevOpsURL ${{ parameters.azureDevOpsURL }} 
        Get-Content ./localhost.mof | Set-Content -Encoding utf8 "../terraform/localhost.mof"