parameters:
  - name: subscription
    type: string
  - name: workingDirectory
    type: string
  - name: terraformVersion
    type: string
  - name: environment
    type: string
  - name: resourceGroup
    type: string
  - name: location
    type: string
    default: uksouth
  - name: storageAccount
    type: string
  - name: containerName
    type: string
  - name: stateKey
    type: string

steps:

  - template: terraform-prep.yaml
    parameters:
      terraformVersion: ${{ parameters.terraformVersion }}
      subscription: $${{ parameters.subscription }}
      environment: ${{ parameters.environment }}
      resourceGroup: ${{ parameters.resourceGroup }}
      location: ${{ parameters.location }}
      storageAccount: ${{ parameters.storageAccount }}
      containerName: ${{ parameters.containerName }}
      stateKey: ${{ parameters.stateKey}}
      workingDirectory: ${{parameters.workingDirectory}}

  - task: TerraformCLI@0
    displayName: Terraform Destroy
    inputs:
      command: destroy
      workingDirectory: ${{parameters.workingDirectory}}
      environmentServiceName: ${{ parameters.subscription }}

