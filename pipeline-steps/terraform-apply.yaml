parameters:
  - name: token
    type: string
  - name: subscription
    type: string
  - name: workingDirectory
    type: string
  - name: environment
    type: string
  - name: planLocation
    type: string

steps:

  - task: Bash@3
    displayName: 'set_up.sh Personal Access Token Replacement'
    inputs:
      targetType: 'inline'
      workingDirectory: ${{parameters.workingDirectory}}
      script: |
            
            sed -i 's|TOKEN|${{parameters.token}}|gI' 'set_up.sh'

  - task: TerraformCLI@0
    displayName: Terraform apply
    inputs:
      workingDirectory: ${{parameters.workingDirectory}}
      command: apply
      environmentServiceName: ${{ parameters.subscription }}
      commandOptions: -auto-approve "${{ parameters.planLocation }}"